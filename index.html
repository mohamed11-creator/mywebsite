<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BusinessLinks</title>
<style>
    body { margin: 0; font-family: Impact, Charcoal, sans-serif; background: white; color: black; }
    #splash { display: flex; justify-content: center; align-items: center; height: 100vh; font-size: 3em; }
    #gallery { display: none; padding: 20px; }
    .slot { width: 200px; aspect-ratio: 9/16; margin: 10px; display: inline-block; vertical-align: top; border: 1px solid #ccc; position: relative; }
    .slot img { width: 100%; height: 100%; object-fit: cover; }
    .controls { margin-top: 5px; text-align: center; }
    .controls input, .controls button { margin: 2px; }
</style>
</head>
<body>

<!-- Splash -->
<div id="splash">BusinessLinks</div>

<!-- Gallery -->
<div id="gallery">
  <div id="slotsContainer"></div>
</div>

<script>
// === CONFIG ===
const CLOUDINARY_UPLOAD_PRESET = "your_preset";
const CLOUDINARY_CLOUD_NAME = "your_cloud_name";
const JSONBIN_URL = "https://api.jsonbin.io/v3/b/YOUR_BIN_ID";
const JSONBIN_KEY = "YOUR_JSONBIN_SECRET_KEY";
const ADMIN = true; // set to false to hide upload/edit buttons for others
const TOTAL_SLOTS = 24;

// === SPLASH FADE IN/OUT ===
window.addEventListener("load", () => {
    const splash = document.getElementById('splash');
    setTimeout(() => {
        splash.style.transition = 'opacity 1s';
        splash.style.opacity = 0;
        setTimeout(() => { splash.style.display = 'none'; showGallery(); }, 1000);
    }, 4000); // show 4s
});

// === SHOW GALLERY ===
function showGallery() {
    document.getElementById('gallery').style.display = 'block';
    loadSlots();
}

// === LOAD SLOTS FROM JSON ===
async function loadSlots() {
    const container = document.getElementById('slotsContainer');
    container.innerHTML = '';
    let data = {};
    try {
        const res = await fetch(JSONBIN_URL, { headers: { "X-Master-Key": JSONBIN_KEY } });
        const json = await res.json();
        data = json.record || {};
    } catch(e){ console.error("JSONBin fetch error:", e); }

    for(let i=0; i<TOTAL_SLOTS; i++){
        const slot = document.createElement('div');
        slot.className = 'slot';
        const img = document.createElement('img');
        img.src = data[`img${i}`] || '';
        slot.appendChild(img);

        // controls only for admin
        if(ADMIN){
            const controls = document.createElement('div');
            controls.className = 'controls';

            // Upload button
            const uploadBtn = document.createElement('input');
            uploadBtn.type = 'file';
            uploadBtn.addEventListener('change', e => uploadImage(e.target.files[0], i));
            controls.appendChild(uploadBtn);

            // Link input
            const linkInput = document.createElement('input');
            linkInput.type = 'text';
            linkInput.placeholder = 'Enter link';
            linkInput.value = data[`link${i}`] || '';
            linkInput.addEventListener('change', e => saveLink(e.target.value, i));
            controls.appendChild(linkInput);

            // Remove button
            const removeBtn = document.createElement('button');
            removeBtn.textContent = 'Remove';
            removeBtn.addEventListener('click', () => removeSlot(i));
            controls.appendChild(removeBtn);

            slot.appendChild(controls);
        }

        container.appendChild(slot);
    }
}

// === UPLOAD IMAGE TO CLOUDINARY ===
async function uploadImage(file, slotIndex){
    if(!file) return;
    const form = new FormData();
    form.append('file', file);
    form.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);

    const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/upload`, {
        method: 'POST',
        body: form
    });
    const data = await res.json();
    saveImageUrl(data.secure_url, slotIndex);
}

// === SAVE IMAGE URL TO JSONBIN ===
async function saveImageUrl(url, slotIndex){
    try{
        const res = await fetch(JSONBIN_URL, { headers: { "X-Master-Key": JSONBIN_KEY } });
        const json = await res.json();
        const record = json.record || {};
        record[`img${slotIndex}`] = url;
        await fetch(JSONBIN_URL, {
            method: 'PUT',
            headers: { "Content-Type":"application/json", "X-Master-Key": JSONBIN_KEY },
            body: JSON.stringify(record)
        });
        loadSlots();
    } catch(e){ console.error("Error saving image URL:", e); }
}

// === SAVE LINK ===
async function saveLink(link, slotIndex){
    try{
        const res = await fetch(JSONBIN_URL, { headers: { "X-Master-Key": JSONBIN_KEY } });
        const json = await res.json();
        const record = json.record || {};
        record[`link${slotIndex}`] = link;
        await fetch(JSONBIN_URL, {
            method: 'PUT',
            headers: { "Content-Type":"application/json", "X-Master-Key": JSONBIN_KEY },
            body: JSON.stringify(record)
        });
    } catch(e){ console.error("Error saving link:", e); }
}

// === REMOVE SLOT ===
async function removeSlot(slotIndex){
    try{
        const res = await fetch(JSONBIN_URL, { headers: { "X-Master-Key": JSONBIN_KEY } });
        const json = await res.json();
        const record = json.record || {};
        record[`img${slotIndex}`] = '';
        record[`link${slotIndex}`] = '';
        await fetch(JSONBIN_URL, {
            method: 'PUT',
            headers: { "Content-Type":"application/json", "X-Master-Key": JSONBIN_KEY },
            body: JSON.stringify(record)
        });
        loadSlots();
    } catch(e){ console.error("Error removing slot:", e); }
}
</script>

</body>
</html>
