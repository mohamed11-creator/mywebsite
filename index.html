<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BusinessLinks</title>
<style>
  body {
    margin: 0;
    padding: 0;
    font-family: Impact, Charcoal, sans-serif;
    background-color: white;
    color: black;
    text-align: center;
  }

  /* Splash screen */
  #splash {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 4vw;
    z-index: 999;
    opacity: 0;
    transition: opacity 2s;
  }

  #main {
    display: none;
    padding: 20px;
  }

  .gallery {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 20px;
    justify-items: center;
  }

  .slot {
    width: 180px;
    height: 320px; /* 9:16 ratio */
    border: 2px solid #ccc;
    border-radius: 10px;
    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    padding: 5px;
  }

  .slot img {
    width: 100%;
    height: auto;
    flex: 1;
    object-fit: cover;
    border-radius: 8px;
  }

  .slot input[type="text"] {
    width: 90%;
    margin-top: 5px;
    padding: 5px;
    font-size: 0.9rem;
  }

  .slot button {
    margin-top: 5px;
    padding: 5px;
    width: 90%;
    font-size: 0.9rem;
    cursor: pointer;
  }
</style>
</head>
<body>

<!-- Splash Screen -->
<div id="splash">BusinessLinks</div>

<!-- Main Page -->
<div id="main">
  <h1>BusinessLinks Gallery</h1>
  <div class="gallery" id="gallery"></div>
</div>

<script>
// === CONFIGURATION ===
const CLOUDINARY_CLOUD_NAME = 'dsaxcy1sm';
const CLOUDINARY_UPLOAD_PRESET = 'business';
const JSONBIN_BIN_ID = '68df382743b1c97be95889d1';
const JSONBIN_API_KEY = '$2a$10$2DfN5MTeXyZnF0Hjt6dzN.0.ztTRWpmDFkxlQKC2C43xe0J1awN9S';
const NUM_SLOTS = 24;

// === SPLASH SCREEN FADE IN AND OUT ===
const splash = document.getElementById('splash');
const main = document.getElementById('main');
window.addEventListener('load', () => {
  splash.style.opacity = 1;
  setTimeout(() => {
    splash.style.opacity = 0;
    setTimeout(() => {
      splash.style.display = 'none';
      main.style.display = 'block';
      loadGallery();
    }, 2000);
  }, 2000); // 2s fade-in + 2s wait
});

// === LOAD GALLERY FROM JSONBIN ===
async function loadGallery() {
  const res = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}/latest`, {
    headers: { 'X-Master-Key': JSONBIN_API_KEY }
  });
  let data;
  try {
    const json = await res.json();
    data = json.record || {};
  } catch {
    data = {};
  }

  const gallery = document.getElementById('gallery');
  gallery.innerHTML = '';
  
  for (let i = 0; i < NUM_SLOTS; i++) {
    const slotData = data[i] || { image: '', link: '' };
    const slotDiv = document.createElement('div');
    slotDiv.className = 'slot';

    const img = document.createElement('img');
    img.src = slotData.image || '';
    slotDiv.appendChild(img);

    const linkInput = document.createElement('input');
    linkInput.type = 'text';
    linkInput.placeholder = 'Enter URL';
    linkInput.value = slotData.link;
    slotDiv.appendChild(linkInput);

    const uploadBtn = document.createElement('button');
    uploadBtn.textContent = 'Upload Image';
    uploadBtn.onclick = () => uploadImage(i, img);
    slotDiv.appendChild(uploadBtn);

    const saveLinkBtn = document.createElement('button');
    saveLinkBtn.textContent = 'Save Link';
    saveLinkBtn.onclick = () => saveLink(i, linkInput.value);
    slotDiv.appendChild(saveLinkBtn);

    const removeBtn = document.createElement('button');
    removeBtn.textContent = 'Remove';
    removeBtn.onclick = () => removeSlot(i);
    slotDiv.appendChild(removeBtn);

    gallery.appendChild(slotDiv);
  }
}

// === UPLOAD IMAGE TO CLOUDINARY ===
function uploadImage(slotIndex, imgElement) {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'image/*';
  input.onchange = async () => {
    const file = input.files[0];
    const formData = new FormData();
    formData.append('file', file);
    formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
    
    const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/upload`, {
      method: 'POST',
      body: formData
    });
    const data = await res.json();
    imgElement.src = data.secure_url;
    saveImage(slotIndex, data.secure_url);
  };
  input.click();
}

// === SAVE IMAGE URL TO JSONBIN ===
async function saveImage(slotIndex, url) {
  const res = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}/latest`, {
    headers: { 'X-Master-Key': JSONBIN_API_KEY }
  });
  let data;
  try {
    const json = await res.json();
    data = json.record || {};
  } catch { data = {}; }

  data[slotIndex] = data[slotIndex] || {};
  data[slotIndex].image = url;

  await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
      'X-Master-Key': JSONBIN_API_KEY
    },
    body: JSON.stringify(data)
  });
}

// === SAVE LINK TO JSONBIN ===
async function saveLink(slotIndex, link) {
  const res = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}/latest`, {
    headers: { 'X-Master-Key': JSONBIN_API_KEY }
  });
  let data;
  try {
    const json = await res.json();
    data = json.record || {};
  } catch { data = {}; }

  data[slotIndex] = data[slotIndex] || {};
  data[slotIndex].link = link;

  await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
      'X-Master-Key': JSONBIN_API_KEY
    },
    body: JSON.stringify(data)
  });
}

// === REMOVE SLOT CONTENT ===
async function removeSlot(slotIndex) {
  const res = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}/latest`, {
    headers: { 'X-Master-Key': JSONBIN_API_KEY }
  });
  let data;
  try {
    const json = await res.json();
    data = json.record || {};
  } catch { data = {}; }

  data[slotIndex] = { image: '', link: '' };

  await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
      'X-Master-Key': JSONBIN_API_KEY
    },
    body: JSON.stringify(data)
  });

  loadGallery();
}
</script>
</body>
</html>
